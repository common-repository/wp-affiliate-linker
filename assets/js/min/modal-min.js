var wp_affiliate_linker_modal_searching=!1,wp_affiliate_linker_modal_results={};jQuery(document).ready(function($){$("body").on("change","form.wp-affiliate-linker-modal input[type=search]",function(e){wp_affiliate_linker_modal_searching||(wp_affiliate_linker_modal_searching=!0,wp_affiliate_linker_modal_results={},$("form input[type=submit]").prop("disabled",!0),$("form ul li").remove(),$("span.spinner").show(),$.post(wp_affiliate_linker_modal.ajax,{action:"wp_affiliate_linker_search",nonce:wp_affiliate_linker_modal.nonce,keywords:$(this).val()},function(e){if(wp_affiliate_linker_modal_searching=!1,$("span.spinner").hide(),!e.success)return void $("form ul").append("<li>1"+wp_affiliate_linker_modal.strings.error+"</li>");if(!e.data)return void $("form ul").append("<li>"+wp_affiliate_linker_modal.strings.no_results+"</li>");for(var i=0;i<e.data.length;i++){wp_affiliate_linker_modal_results[e.data[i].ID]=e.data[i];var a="<li>";a+='<input type="radio" name="post_id" value="'+wp_affiliate_linker_modal_results[e.data[i].ID].ID+'" />',a+='<span class="title">'+wp_affiliate_linker_modal_results[e.data[i].ID].post_title+"</span>",a+='<span class="url">'+wp_affiliate_linker_modal_results[e.data[i].ID].link.url+"</span>",$("form ul").append(a)}}))}),$("form.wp-affiliate-linker-modal input[type=search]").trigger("change"),$("body").on("click","form.wp-affiliate-linker-modal ul li",function(e){0!=$("input[type=radio]",$(this).parent()).length&&($("form ul li.selected").removeClass("selected"),$("input[type=radio]",$(this).parent()).prop("checked",!1),$(this).addClass("selected"),$("input[type=radio]",$(this)).prop("checked",!0),$("form input[type=submit]").prop("disabled",!1))}),$("body").on("click","form.wp-affiliate-linker-modal button.close",function(e){$("#wp-affiliate-linker-modal").length>0?tinymce.activeEditor.windowManager.close():parent.tb_remove()}),$("body").on("click","form.wp-affiliate-linker-modal input[type=submit]",function(e){e.preventDefault();var i=$("form.wp-affiliate-linker-modal input[name=post_id]:checked").val();if(void 0==typeof i)return void alert(wp_affiliate_linker_modal.strings.no_link_selected);if(void 0==typeof wp_affiliate_linker_modal_results[i])return void alert("Link was selected, but its data could not be loaded. Please close the modal and try again.");var a='<a href="'+wp_affiliate_linker_modal_results[i].cloaked_url+'"';if("_blank"==wp_affiliate_linker_modal_results[i].link.target&&(a+=' target="_blank"'),"1"==wp_affiliate_linker_modal_results[i].link.nofollow&&(a+=' rel="nofollow"'),a+=">",$("#wp-affiliate-linker-modal").length>0)return a+=tinyMCE.activeEditor.selection.getContent().length>0?tinyMCE.activeEditor.selection.getContent():wp_affiliate_linker_modal_results[i].post_title,a+="</a>",tinyMCE.activeEditor.execCommand("mceReplaceContent",!1,a),void tinyMCE.activeEditor.windowManager.close();var t=parent.wp_affiliate_linker_get_selected_text();a+=t.text.length>0?t.text:wp_affiliate_linker_modal_results[i].post_title,a+="</a>";var l=parent.document.getElementById("content"),n=l.value;l.value=n.slice(0,t.start)+a+n.slice(t.end),$(l).trigger("change"),parent.tb_remove()})});